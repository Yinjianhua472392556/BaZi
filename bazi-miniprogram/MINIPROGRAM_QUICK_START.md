# 微信小程序快速启动指南

## 当前状态 (2025-09-25 最新验证)
✅ **后端服务已运行** - http://10.60.20.222:8001  
✅ **API接口已验证** - 八字计算、起名、生肖配对等功能正常  
✅ **真实算法已启用** - sxtwl、zhdate 等核心库正常运行  
✅ **所有依赖已安装** - 无需重新安装，直接启动即可  

## ⚡ 超快启动 (推荐方式)

### 第一步：启动后端服务 (30秒)
```bash
cd bazi-miniprogram
source venv/bin/activate
python main.py
```

看到以下输出表示成功：
```
✅ 算法模块导入成功
🚀 启动八字运势小程序 FastAPI 服务器 (真实算法版)
📍 本机IP地址: 10.60.20.222
🌐 访问地址: http://10.60.20.222:8001
🧮 算法状态: 真实算法已启用
```

### 第二步：验证API服务 (可选)
```bash
# 快速健康检查
curl -s http://10.60.20.222:8001/health
```

## 微信开发者工具配置步骤

### 1. 快速导入项目 (如已安装微信开发者工具)
1. 打开微信开发者工具
2. 点击"导入项目"  
3. **项目目录**：`/Users/yinjianhua/Desktop/Demo/Bazi/bazi-miniprogram/miniprogram`
4. **AppID**：选择"测试号"（无需真实AppID）
5. **项目名称**：八字运势小程序
6. 点击"导入"

### 2. 关键配置 (必须设置)
1. **关闭域名校验** (重要！)：
   - 开发者工具右上角 → **详情** → **本地设置**
   - ✅ 勾选"**不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**"

2. **启用调试模式**：
   - 同样在"本地设置"中
   - ✅ 勾选"**开启调试模式**"

### 3. 首次安装微信开发者工具 (如需要)
- 访问：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
- 下载macOS版本并安装
- 或使用 Homebrew：`brew install --cask wechat-devtools`

### 4. 项目功能验证
导入成功后，你将看到4个Tab页面：
- **八字测算** - 主要功能页面
- **节日列表** - 传统节日和节气
- **生肖配对** - 生肖匹配功能  
- **个人中心** - 用户信息管理

### 5. 测试API连接
1. 在首页点击相关测试按钮
2. 观察控制台网络请求
3. 确认能正常访问 http://localhost:8000

## 🎯 功能验证流程

### 方式一：直接在小程序中测试
1. **八字测算测试**：
   - 年份：1990、月份：6、日期：15、时间：14点、性别：男
   - 点击"开始测算" → 验证结果页面显示

2. **起名功能测试**：
   - 姓氏：李、性别：男、生日信息
   - 点击"开始起名" → 验证起名建议显示

### 方式二：直接测试API (开发者推荐)
```bash
# 1. 健康检查
curl -s http://10.60.20.222:8001/health

# 2. 八字计算测试
curl -X POST http://10.60.20.222:8001/api/v1/calculate-bazi \
  -H "Content-Type: application/json" \
  -d '{"year":1990,"month":6,"day":15,"hour":14,"gender":"male","name":"测试"}'

# 3. 起名功能测试  
curl -X POST http://10.60.20.222:8001/api/v1/naming/generate-names \
  -H "Content-Type: application/json" \
  -d '{"surname":"李","gender":"male","birth_year":1990,"birth_month":6,"birth_day":15}'
```

### 已验证正常的API接口 ✅
- ✅ 健康检查：`GET /health`
- ✅ 八字计算：`POST /api/v1/calculate-bazi`  
- ✅ 起名功能：`POST /api/v1/naming/generate-names`
- ✅ 生肖配对：`POST /api/v1/zodiac-matching`
- ✅ 节日查询：`GET /api/v1/festivals`
- ✅ 图标生成：`GET /api/v1/tab-icons/*`

## ⚠️ 重要注意事项
1. **后端必须先启动**：确保 http://10.60.20.222:8001 可访问  
2. **域名校验必须关闭**：开发环境必须设置，否则API调用失败  
3. **网络请求监控**：使用开发者工具的Network标签监控API调用  
4. **端口号已更新**：新版本使用8001端口，不是8000  

## 🔧 常见问题快速解决

| 问题症状 | 原因 | 解决方案 |
|---------|------|----------|
| 网络请求失败 | 后端未启动或端口错误 | 检查 http://10.60.20.222:8001/health |
| 小程序白屏 | 域名校验未关闭 | 详情→本地设置→不校验域名 |
| API返回错误 | 数据格式问题 | 查看控制台Network标签 |
| 算法功能异常 | 依赖库问题 | 重启后端服务 |

## 🚀 快速访问链接

- **API文档**: http://10.60.20.222:8001/docs
- **健康检查**: http://10.60.20.222:8001/health  
- **后端首页**: http://10.60.20.222:8001/
- **详细启动指南**: 查看 `QUICK_START.md`

现在你可以在微信开发者工具中愉快地开发小程序了！🎉
