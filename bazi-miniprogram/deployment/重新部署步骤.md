# ðŸš€ æœåŠ¡å™¨é‡æ–°éƒ¨ç½²è¯¦ç»†æ­¥éª¤

## ðŸ“‹ ç¬¬ä¸€æ­¥ï¼šè¿žæŽ¥åˆ°æœåŠ¡å™¨

ä½¿ç”¨SSHè¿žæŽ¥åˆ°æ‚¨çš„è…¾è®¯äº‘æœåŠ¡å™¨ï¼š
```bash
ssh root@119.91.146.128
```

## ðŸ“‹ ç¬¬äºŒæ­¥ï¼šåœæ­¢çŽ°æœ‰æœåŠ¡

ä¸ºäº†å®‰å…¨é‡æ–°éƒ¨ç½²ï¼Œå…ˆåœæ­¢çŽ°æœ‰æœåŠ¡ï¼š
```bash
# åœæ­¢APIæœåŠ¡å’ŒNginx
systemctl stop bazi-api nginx

# ç¡®è®¤æœåŠ¡å·²åœæ­¢
systemctl status bazi-api nginx
```

## ðŸ“‹ ç¬¬ä¸‰æ­¥ï¼šå®šä½å¹¶è¿›å…¥é¡¹ç›®ç›®å½•

```bash
# æŸ¥æ‰¾é¡¹ç›®ä½ç½®
find /opt -name "bazi-miniprogram" 2>/dev/null

# è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆæ ¹æ®å®žé™…è·¯å¾„è°ƒæ•´ï¼‰
cd /opt/bazi-app/bazi-miniprogram
```

å¦‚æžœæ‰¾ä¸åˆ°é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨é‡æ–°å…‹éš†æ–¹æ¡ˆï¼š
```bash
cd /opt
mkdir -p bazi-app && cd bazi-app
git clone https://github.com/Yinjianhua472392556/BaZi.git
cd BaZi/bazi-miniprogram
```

## ðŸ“‹ ç¬¬å››æ­¥ï¼šæ‹‰å–æœ€æ–°ä»£ç 

```bash
# æ‹‰å–æœ€æ–°çš„ä¿®å¤ä»£ç 
git pull origin main

# ç¡®è®¤æ‹‰å–æˆåŠŸ
git log --oneline -5
```

## ðŸ“‹ ç¬¬äº”æ­¥ï¼šè¿›å…¥éƒ¨ç½²ç›®å½•

```bash
cd deployment

# ç¡®è®¤ä¿®å¤è„šæœ¬å­˜åœ¨
ls -la auto_deploy.sh fix_ssl_issues.sh
```

## ðŸ“‹ ç¬¬å…­æ­¥ï¼šæ‰§è¡Œé‡æ–°éƒ¨ç½²

### æ–¹æ¡ˆä¸€ï¼šå®Œæ•´é‡æ–°éƒ¨ç½²ï¼ˆæŽ¨èï¼‰
```bash
sudo bash auto_deploy.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹çŽ¯å¢ƒ
- âœ… é‡æ–°å®‰è£…ä¾èµ–
- âœ… é‡æ–°é…ç½®æœåŠ¡
- âœ… æ™ºèƒ½ä¿®å¤SSLè¯ä¹¦
- âœ… å¯åŠ¨æ‰€æœ‰æœåŠ¡

### æ–¹æ¡ˆäºŒï¼šä»…ä¿®å¤SSLé—®é¢˜
å¦‚æžœåªæ˜¯SSLé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ï¼š
```bash
sudo bash fix_ssl_issues.sh
```

## ðŸ“‹ ç¬¬ä¸ƒæ­¥ï¼šéªŒè¯éƒ¨ç½²ç»“æžœ

ç­‰å¾…éƒ¨ç½²å®ŒæˆåŽï¼ŒéªŒè¯æœåŠ¡çŠ¶æ€ï¼š

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status bazi-api nginx

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep -E ':(80|443|8001) '

# 3. æµ‹è¯•HTTPè®¿é—®
curl -I http://api.bazi365.top/health

# 4. æµ‹è¯•HTTPSè®¿é—®
curl -I https://api.bazi365.top/health

# 5. æ£€æŸ¥SSLè¯ä¹¦
ls -la /etc/letsencrypt/live/api.bazi365.top/
```

## ðŸŽ¯ é¢„æœŸæˆåŠŸç»“æžœ

éƒ¨ç½²æˆåŠŸåŽæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

1. **æœåŠ¡çŠ¶æ€æ­£å¸¸**ï¼š
   ```
   â— bazi-api.service - å…«å­—è¿åŠ¿å°ç¨‹åº APIæœåŠ¡
      Active: active (running)
   
   â— nginx.service - A high performance web server
      Active: active (running)
   ```

2. **ç«¯å£æ­£å¸¸ç›‘å¬**ï¼š
   ```
   :80    LISTEN    nginx
   :443   LISTEN    nginx  
   :8001  LISTEN    python
   ```

3. **HTTPå’ŒHTTPSè®¿é—®éƒ½æ­£å¸¸**ï¼š
   ```
   HTTP/1.1 200 OK        # HTTPè®¿é—®
   HTTP/2 200             # HTTPSè®¿é—®
   ```

## ðŸ†˜ å¦‚æžœéƒ¨ç½²å¤±è´¥

### æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š
```bash
# æŸ¥çœ‹APIæœåŠ¡æ—¥å¿—
journalctl -u bazi-api -f

# æŸ¥çœ‹Nginxæ—¥å¿—
tail -f /var/log/nginx/error.log

# æµ‹è¯•Nginxé…ç½®
nginx -t
```

### é‡æ–°å°è¯•ï¼š
```bash
# å¦‚æžœéƒ¨ç½²å¤±è´¥ï¼Œå¯ä»¥é‡æ–°è¿è¡Œ
sudo bash auto_deploy.sh
```

### ç´§æ€¥æ¢å¤HTTPæœåŠ¡ï¼š
å¦‚æžœHTTPSæœ‰é—®é¢˜ä½†éœ€è¦å…ˆæ¢å¤HTTPæœåŠ¡ï¼š
```bash
# åˆ›å»ºç®€å•HTTPé…ç½®
cat > /etc/nginx/sites-available/bazi-api << 'EOF'
server {
    listen 80;
    server_name api.bazi365.top;
    
    location / {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
EOF

# å¯ç”¨é…ç½®å¹¶é‡å¯
nginx -t && systemctl restart nginx
systemctl start bazi-api
```

## ðŸ“ž å®Œæˆæ ‡å¿—

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºæ—¶ï¼Œè¡¨ç¤ºéƒ¨ç½²å®Œå…¨æˆåŠŸï¼š

```
âœ… SSLè¯ä¹¦å’ŒHTTPSé…ç½®å®Œæˆ
âœ… æ‰€æœ‰æœåŠ¡å¯åŠ¨å®Œæˆ
âœ… éƒ¨ç½²éªŒè¯å®Œæˆ
ðŸŽ‰ éƒ¨ç½²å®Œæˆï¼
```

çŽ°åœ¨æ‚¨çš„å…«å­—è¿åŠ¿å°ç¨‹åºAPIæœåŠ¡å·²ç»å®Œå…¨æ¢å¤æ­£å¸¸ï¼ŒHTTPSè®¿é—®é—®é¢˜å·²è§£å†³ï¼

---

**ðŸ’¡ æç¤º**ï¼šå¦‚æžœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ‰€æœ‰çš„ä¿®å¤è„šæœ¬éƒ½åŒ…å«è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œè‡ªåŠ¨æ¢å¤æœºåˆ¶ï¼Œå¯ä»¥å®‰å…¨åœ°é‡å¤è¿è¡Œã€‚
