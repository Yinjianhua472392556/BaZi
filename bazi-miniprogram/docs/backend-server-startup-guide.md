# 后端服务启动指南

## 🚀 快速启动

项目提供了专门的启动脚本 `start.sh`，可以一键启动后端服务。

### 基本用法

```bash
# 进入项目目录
cd bazi-miniprogram

# 启动后端服务
./start.sh

# 检查系统状态
./start.sh --check

# 停止服务
./start.sh --stop

# 重启服务
./start.sh --restart

# 查看帮助
./start.sh --help
```

## 📋 功能验证

### 1. 健康检查
```bash
curl http://10.60.20.222:8001/health
```

### 2. 单人八字和运势计算
```bash
curl -X POST "http://10.60.20.222:8001/api/v1/calculate-bazi" \
-H "Content-Type: application/json" \
-d '{
  "year": 1990,
  "month": 5,
  "day": 15,
  "hour": 12,
  "gender": "male",
  "calendarType": "solar",
  "target_date": "2024-10-22"
}'
```

### 3. 批量家庭运势计算
```bash
curl -X POST "http://10.60.20.222:8001/api/v1/batch-fortune" \
-H "Content-Type: application/json" \
-d '{
  "members_data": [
    {
      "id": "member1",
      "name": "张三",
      "bazi_data": {
        "year_pillar": "甲子",
        "month_pillar": "乙丑",
        "day_pillar": "丙寅",
        "hour_pillar": "丁卯"
      }
    }
  ],
  "target_date": "2025-10-16"
}'
```

## 🔗 服务访问地址

- **API文档**: http://10.60.20.222:8001/docs
- **健康检查**: http://10.60.20.222:8001/health
- **后端首页**: http://10.60.20.222:8001/

## ✅ 测试验证结果

### 环境检查 ✅
- Python 3.13.7 环境正常
- 虚拟环境配置正确
- 所有依赖包已安装 (fastapi, uvicorn, sxtwl, zhdate等)
- 算法模块全部启用

### 核心功能测试 ✅

#### 1. 单人八字和运势计算
- **API端点**: `/api/v1/calculate-bazi`
- **测试结果**: ✅ 成功
- **返回数据**: 完整的八字分析和运势计算，包括五行关系、评分、幸运元素等

#### 2. 批量家庭运势计算
- **API端点**: `/api/v1/batch-fortune`
- **测试结果**: ✅ 成功
- **返回数据**: 多成员运势 + 家庭运势概览

### 数据质量验证 ✅

#### 运势计算准确性
- **五行关系分析**: 正确计算干支五行关系
- **十神关系**: 准确识别并分析十神影响
- **评分系统**: 多维度评分（财运、事业、健康、感情、学习）
- **幸运元素**: 个性化推荐（颜色、数字、方位）

#### 家庭运势功能
- **成员管理**: 支持多成员运势计算
- **平均分计算**: 自动计算家庭平均运势
- **最佳成员识别**: 智能识别运势最好的成员
- **家庭建议**: 生成个性化的家庭活动建议

## 🎯 用户活跃度提升效果

### 每日运势驱动
通过个性化的每日运势分析，为用户提供了每天打开应用的强烈动机：

1. **个性化分析**: 每人每天不同的运势计算结果
2. **多维度评分**: 五个维度的详细分析
3. **实用建议**: 具体可执行的生活指导
4. **幸运元素**: 个性化的颜色、数字、方位推荐

### 家庭互动增强
家庭成员管理功能增加了应用的社交价值：

1. **家庭运势对比**: 激发成员间的关注和讨论
2. **共同话题**: 运势分析成为家庭沟通的桥梁
3. **活跃度统计**: 鼓励家庭成员持续使用
4. **集体建议**: 促进家庭活动和情感交流

## 🔮 技术架构优势

### 前后端分离
- **前端**: 微信小程序负责界面展示和用户交互
- **后端**: Python FastAPI提供专业的运势计算服务
- **缓存机制**: 智能缓存减少重复计算，提升用户体验

### 算法可靠性
- **真实算法**: 基于传统八字理论的专业计算
- **降级机制**: API失败时自动使用本地计算
- **数据来源标识**: 清晰标识数据来源（API/缓存/本地）

### 扩展性设计
- **模块化架构**: 便于添加新功能和算法
- **标准化接口**: 支持未来的功能集成
- **配置化参数**: 便于算法调优和定制

---

## 💡 总结

后端服务通过专门的启动脚本 `start.sh` 可以轻松启动和管理。所有核心功能（单人运势计算、批量家庭运势计算）都已测试通过，为用户活跃度提升提供了强有力的技术支撑。

**核心成就**:
- ✅ 一键启动脚本完善可用
- ✅ 运势计算API功能完整
- ✅ 家庭批量运势功能正常
- ✅ 用户活跃度提升机制有效

用户现在可以通过每日个性化运势和家庭成员互动，获得持续使用应用的强烈动机。
