// 权威24节气数据库 - 基于中国科学院紫金山天文台和国家授时中心数据
// 确保2022-2028年商业级精度（零误差容忍）

class AuthoritativeSolarTermsData {
  
  // 权威24节气精确数据（2022-2028年）
  // 数据来源：中国科学院紫金山天文台、国家授时中心
  static AUTHORITATIVE_SOLAR_TERMS = {
    2022: {
      lichun: '2022-02-04T04:50:36+08:00',      // 立春
      yushui: '2022-02-19T00:42:50+08:00',      // 雨水
      jingzhe: '2022-03-05T22:43:34+08:00',     // 惊蛰
      chunfen: '2022-03-20T23:33:15+08:00',     // 春分
      qingming: '2022-04-05T03:20:03+08:00',    // 清明
      guyu: '2022-04-20T10:24:07+08:00',        // 谷雨
      lixia: '2022-05-05T20:25:46+08:00',       // 立夏
      xiaoman: '2022-05-21T09:22:25+08:00',     // 小满
      mangzhong: '2022-06-06T00:25:37+08:00',   // 芒种
      xiazhi: '2022-06-21T17:13:40+08:00',      // 夏至
      xiaoshu: '2022-07-07T10:37:49+08:00',     // 小暑
      dashu: '2022-07-23T04:06:49+08:00',       // 大暑
      liqiu: '2022-08-07T20:28:57+08:00',       // 立秋
      chushu: '2022-08-23T11:15:59+08:00',      // 处暑
      bailu: '2022-09-07T23:32:07+08:00',       // 白露
      qiufen: '2022-09-23T09:03:31+08:00',      // 秋分
      hanlu: '2022-10-08T15:22:16+08:00',       // 寒露
      shuangjiang: '2022-10-23T18:35:31+08:00', // 霜降
      lidong: '2022-11-07T18:45:18+08:00',      // 立冬
      xiaoxue: '2022-11-22T16:20:18+08:00',     // 小雪
      daxue: '2022-12-07T11:46:04+08:00',       // 大雪 ⭐ 权威基准
      dongzhi: '2022-12-22T05:48:01+08:00',     // 冬至
      xiaohan: '2023-01-05T23:04:39+08:00',     // 小寒（次年）
      dahan: '2023-01-20T16:29:20+08:00'        // 大寒（次年）
    },
    
    2023: {
      lichun: '2023-02-04T10:42:21+08:00',      // 立春
      yushui: '2023-02-19T06:34:05+08:00',      // 雨水
      jingzhe: '2023-03-06T04:36:02+08:00',     // 惊蛰
      chunfen: '2023-03-21T05:24:14+08:00',     // 春分
      qingming: '2023-04-05T09:12:52+08:00',    // 清明
      guyu: '2023-04-20T16:13:26+08:00',        // 谷雨
      lixia: '2023-05-06T02:18:34+08:00',       // 立夏
      xiaoman: '2023-05-21T15:08:59+08:00',     // 小满
      mangzhong: '2023-06-06T06:18:10+08:00',   // 芒种
      xiazhi: '2023-06-21T22:57:37+08:00',      // 夏至
      xiaoshu: '2023-07-07T16:30:29+08:00',     // 小暑
      dashu: '2023-07-23T09:50:15+08:00',       // 大暑
      liqiu: '2023-08-08T02:22:41+08:00',       // 立秋
      chushu: '2023-08-23T17:01:06+08:00',      // 处暑
      bailu: '2023-09-08T05:26:31+08:00',       // 白露
      qiufen: '2023-09-23T14:49:46+08:00',      // 秋分
      hanlu: '2023-10-08T21:15:23+08:00',       // 寒露
      shuangjiang: '2023-10-24T00:20:39+08:00', // 霜降
      lidong: '2023-11-08T00:35:23+08:00',      // 立冬
      xiaoxue: '2023-11-22T22:02:29+08:00',     // 小雪
      daxue: '2023-12-07T17:32:44+08:00',       // 大雪 ⭐ 权威基准
      dongzhi: '2023-12-22T11:27:09+08:00',     // 冬至
      xiaohan: '2024-01-06T04:49:09+08:00',     // 小寒（次年）
      dahan: '2024-01-20T22:07:08+08:00'        // 大寒（次年）
    },
    
    2024: {
      lichun: '2024-02-04T16:26:53+08:00',      // 立春
      yushui: '2024-02-19T12:12:58+08:00',      // 雨水
      jingzhe: '2024-03-05T10:22:31+08:00',     // 惊蛰
      chunfen: '2024-03-20T11:06:12+08:00',     // 春分
      qingming: '2024-04-04T15:02:03+08:00',    // 清明
      guyu: '2024-04-19T21:59:33+08:00',        // 谷雨
      lixia: '2024-05-05T08:09:51+08:00',       // 立夏
      xiaoman: '2024-05-20T20:59:14+08:00',     // 小满
      mangzhong: '2024-06-05T12:09:40+08:00',   // 芒种
      xiazhi: '2024-06-21T04:50:46+08:00',      // 夏至
      xiaoshu: '2024-07-06T22:19:49+08:00',     // 小暑
      dashu: '2024-07-22T15:44:11+08:00',       // 大暑
      liqiu: '2024-08-07T08:09:01+08:00',       // 立秋
      chushu: '2024-08-22T22:54:48+08:00',      // 处暑
      bailu: '2024-09-07T11:11:06+08:00',       // 白露
      qiufen: '2024-09-22T20:43:27+08:00',      // 秋分
      hanlu: '2024-10-08T03:00:16+08:00',       // 寒露
      shuangjiang: '2024-10-23T06:14:32+08:00', // 霜降
      lidong: '2024-11-07T06:19:51+08:00',      // 立冬
      xiaoxue: '2024-11-22T03:56:16+08:00',     // 小雪
      daxue: '2024-12-06T23:16:47+08:00',       // 大雪 ⭐ 权威基准
      dongzhi: '2024-12-21T17:20:20+08:00',     // 冬至
      xiaohan: '2025-01-05T10:33:19+08:00',     // 小寒（次年）
      dahan: '2025-01-20T03:55:35+08:00'        // 大寒（次年）
    },
    
    2025: {
      lichun: '2025-02-03T22:10:13+08:00',      // 立春
      yushui: '2025-02-18T18:06:18+08:00',      // 雨水
      jingzhe: '2025-03-05T16:07:13+08:00',     // 惊蛰
      chunfen: '2025-03-20T16:51:16+08:00',     // 春分
      qingming: '2025-04-04T20:48:21+08:00',    // 清明
      guyu: '2025-04-20T03:55:45+08:00',        // 谷雨
      lixia: '2025-05-05T14:01:51+08:00',       // 立夏
      xiaoman: '2025-05-21T02:48:26+08:00',     // 小满
      mangzhong: '2025-06-05T18:01:18+08:00',   // 芒种
      xiazhi: '2025-06-21T10:42:01+08:00',      // 夏至
      xiaoshu: '2025-07-07T04:05:27+08:00',     // 小暑
      dashu: '2025-07-22T21:29:50+08:00',       // 大暑
      liqiu: '2025-08-07T13:53:02+08:00',       // 立秋
      chushu: '2025-08-23T04:34:48+08:00',      // 处暑
      bailu: '2025-09-07T16:51:38+08:00',       // 白露
      qiufen: '2025-09-23T02:19:04+08:00',      // 秋分
      hanlu: '2025-10-08T08:39:33+08:00',       // 寒露
      shuangjiang: '2025-10-23T11:51:16+08:00', // 霜降
      lidong: '2025-11-07T11:59:47+08:00',      // 立冬
      xiaoxue: '2025-11-22T09:34:48+08:00',     // 小雪
      daxue: '2025-12-07T12:04:20+08:00',       // 大雪 ⭐ 权威基准 (12月7日!)
      dongzhi: '2025-12-21T23:02:48+08:00',     // 冬至
      xiaohan: '2026-01-05T16:15:45+08:00',     // 小寒（次年）
      dahan: '2026-01-20T09:39:43+08:00'        // 大寒（次年）
    },
    
    2026: {
      lichun: '2026-02-04T04:01:51+08:00',      // 立春
      yushui: '2026-02-18T23:51:41+08:00',      // 雨水
      jingzhe: '2026-03-05T21:58:43+08:00',     // 惊蛰
      chunfen: '2026-03-20T22:45:51+08:00',     // 春分
      qingming: '2026-04-05T02:39:28+08:00',    // 清明
      guyu: '2026-04-20T09:38:58+08:00',        // 谷雨
      lixia: '2026-05-05T19:47:01+08:00',       // 立夏
      xiaoman: '2026-05-21T08:31:16+08:00',     // 小满
      mangzhong: '2026-06-05T23:49:52+08:00',   // 芒种
      xiazhi: '2026-06-21T16:24:42+08:00',      // 夏至
      xiaoshu: '2026-07-07T09:56:29+08:00',     // 小暑
      dashu: '2026-07-23T03:15:12+08:00',       // 大暑
      liqiu: '2026-08-07T19:43:52+08:00',       // 立秋
      chushu: '2026-08-23T10:18:35+08:00',      // 处暑
      bailu: '2026-09-07T22:40:02+08:00',       // 白露
      qiufen: '2026-09-23T08:05:00+08:00',      // 秋分
      hanlu: '2026-10-08T14:27:48+08:00',       // 寒露
      shuangjiang: '2026-10-23T17:35:33+08:00', // 霜降
      lidong: '2026-11-07T17:47:37+08:00',      // 立冬
      xiaoxue: '2026-11-22T15:17:50+08:00',     // 小雪
      daxue: '2026-12-07T10:52:06+08:00',       // 大雪 ⭐ 权威基准
      dongzhi: '2026-12-22T04:49:55+08:00',     // 冬至
      xiaohan: '2027-01-05T22:00:31+08:00',     // 小寒（次年）
      dahan: '2027-01-20T15:21:51+08:00'        // 大寒（次年）
    },
    
    2027: {
      lichun: '2027-02-04T09:46:00+08:00',      // 立春
      yushui: '2027-02-19T05:43:56+08:00',      // 雨水
      jingzhe: '2027-03-06T03:44:15+08:00',     // 惊蛰
      chunfen: '2027-03-21T04:24:37+08:00',     // 春分
      qingming: '2027-04-05T08:17:12+08:00',    // 清明
      guyu: '2027-04-20T15:24:27+08:00',        // 谷雨
      lixia: '2027-05-06T01:32:51+08:00',       // 立夏
      xiaoman: '2027-05-21T14:17:52+08:00',     // 小满
      mangzhong: '2027-06-06T05:35:41+08:00',   // 芒种
      xiazhi: '2027-06-21T22:10:57+08:00',      // 夏至
      xiaoshu: '2027-07-07T15:42:16+08:00',     // 小暑
      dashu: '2027-07-23T09:00:16+08:00',       // 大暑
      liqiu: '2027-08-08T01:29:03+08:00',       // 立秋
      chushu: '2027-08-23T16:01:48+08:00',      // 处暑
      bailu: '2027-09-08T04:28:46+08:00',       // 白露
      qiufen: '2027-09-23T13:53:38+08:00',      // 秋分
      hanlu: '2027-10-08T20:16:14+08:00',       // 寒露
      shuangjiang: '2027-10-23T23:19:33+08:00', // 霜降
      lidong: '2027-11-07T23:34:01+08:00',      // 立冬
      xiaoxue: '2027-11-22T21:02:15+08:00',     // 小雪
      daxue: '2027-12-07T16:40:09+08:00',       // 大雪 ⭐ 权威基准
      dongzhi: '2027-12-22T10:41:55+08:00',     // 冬至
      xiaohan: '2028-01-06T03:47:53+08:00',     // 小寒（次年）
      dahan: '2028-01-20T21:06:43+08:00'        // 大寒（次年）
    },
    
    2028: {
      lichun: '2028-02-04T15:30:53+08:00',      // 立春
      yushui: '2028-02-19T11:31:16+08:00',      // 雨水
      jingzhe: '2028-03-05T09:36:57+08:00',     // 惊蛰
      chunfen: '2028-03-20T10:16:49+08:00',     // 春分
      qingming: '2028-04-04T14:02:43+08:00',    // 清明
      guyu: '2028-04-19T21:09:42+08:00',        // 谷雨
      lixia: '2028-05-05T07:18:26+08:00',       // 立夏
      xiaoman: '2028-05-20T20:07:34+08:00',     // 小满
      mangzhong: '2028-06-05T11:21:09+08:00',   // 芒种
      xiazhi: '2028-06-21T03:51:48+08:00',      // 夏至
      xiaoshu: '2028-07-06T21:30:43+08:00',     // 小暑
      dashu: '2028-07-22T14:44:14+08:00',       // 大暑
      liqiu: '2028-08-07T07:13:14+08:00',       // 立秋
      chushu: '2028-08-22T21:55:08+08:00',      // 处暑
      bailu: '2028-09-07T10:08:54+08:00',       // 白露
      qiufen: '2028-09-22T19:44:21+08:00',      // 秋分
      hanlu: '2028-10-08T02:00:16+08:00',       // 寒露
      shuangjiang: '2028-10-23T05:13:41+08:00', // 霜降
      lidong: '2028-11-07T05:24:30+08:00',      // 立冬
      xiaoxue: '2028-11-22T02:54:02+08:00',     // 小雪
      daxue: '2028-12-06T22:26:52+08:00',       // 大雪 ⭐ 权威基准
      dongzhi: '2028-12-21T16:19:42+08:00',     // 冬至
      xiaohan: '2029-01-05T09:38:51+08:00',     // 小寒（次年）
      dahan: '2029-01-20T02:59:45+08:00'        // 大寒（次年）
    }
  };

  // 节气名称到太阳黄经的映射
  static SOLAR_TERM_LONGITUDES = {
    lichun: 315,    // 立春
    yushui: 330,    // 雨水
    jingzhe: 345,   // 惊蛰
    chunfen: 0,     // 春分
    qingming: 15,   // 清明
    guyu: 30,       // 谷雨
    lixia: 45,      // 立夏
    xiaoman: 60,    // 小满
    mangzhong: 75,  // 芒种
    xiazhi: 90,     // 夏至
    xiaoshu: 105,   // 小暑
    dashu: 120,     // 大暑
    liqiu: 135,     // 立秋
    chushu: 150,    // 处暑
    bailu: 165,     // 白露
    qiufen: 180,    // 秋分
    hanlu: 195,     // 寒露
    shuangjiang: 210, // 霜降
    lidong: 225,    // 立冬
    xiaoxue: 240,   // 小雪
    daxue: 255,     // 大雪
    dongzhi: 270,   // 冬至
    xiaohan: 285,   // 小寒
    dahan: 300      // 大寒
  };

  // 节气中文名称映射
  static SOLAR_TERM_NAMES = {
    lichun: '立春',
    yushui: '雨水',
    jingzhe: '惊蛰',
    chunfen: '春分',
    qingming: '清明',
    guyu: '谷雨',
    lixia: '立夏',
    xiaoman: '小满',
    mangzhong: '芒种',
    xiazhi: '夏至',
    xiaoshu: '小暑',
    dashu: '大暑',
    liqiu: '立秋',
    chushu: '处暑',
    bailu: '白露',
    qiufen: '秋分',
    hanlu: '寒露',
    shuangjiang: '霜降',
    lidong: '立冬',
    xiaoxue: '小雪',
    daxue: '大雪',
    dongzhi: '冬至',
    xiaohan: '小寒',
    dahan: '大寒'
  };

  /**
   * 获取权威的节气时间（商业级精度）
   * @param {number} year - 年份
   * @param {string} solarTermId - 节气ID
   * @returns {Date|null} 精确的节气时间
   */
  static getAuthoritativeSolarTermTime(year, solarTermId) {
    const yearData = this.AUTHORITATIVE_SOLAR_TERMS[year];
    if (!yearData || !yearData[solarTermId]) {
      return null;
    }
    
    // 直接使用权威时间数据
    return new Date(yearData[solarTermId]);
  }

  /**
   * 检查是否在权威数据覆盖范围内
   * @param {number} year - 年份
   * @returns {boolean} 是否有权威数据
   */
  static hasAuthoritativeData(year) {
    return year >= 2022 && year <= 2028;
  }

  /**
   * 获取指定年份的所有节气数据
   * @param {number} year - 年份
   * @returns {Object|null} 该年的所有节气数据
   */
  static getYearSolarTerms(year) {
    if (!this.hasAuthoritativeData(year)) {
      return null;
    }
    
    const yearData = this.AUTHORITATIVE_SOLAR_TERMS[year];
    const result = {};
    
    Object.keys(yearData).forEach(termId => {
      result[termId] = {
        id: termId,
        name: this.SOLAR_TERM_NAMES[termId],
        time: new Date(yearData[termId]),
        longitude: this.SOLAR_TERM_LONGITUDES[termId],
        source: 'authoritative'
      };
    });
    
    return result;
  }

  /**
   * 验证计算结果与权威数据的差异
   * @param {number} year - 年份
   * @param {string} solarTermId - 节气ID
   * @param {Date} calculatedTime - 计算出的时间
   * @returns {Object} 验证结果
   */
  static validateCalculation(year, solarTermId, calculatedTime) {
    const authoritativeTime = this.getAuthoritativeSolarTermTime(year, solarTermId);
    
    if (!authoritativeTime) {
      return {
        isValid: false,
        error: '无权威数据',
        year,
        solarTermId
      };
    }
    
    const diffMs = Math.abs(calculatedTime.getTime() - authoritativeTime.getTime());
    const diffHours = diffMs / (1000 * 60 * 60);
    const diffDays = diffHours / 24;
    
    return {
      isValid: diffDays <= 0.5, // 12小时容忍度
      authoritativeTime,
      calculatedTime,
      diffMs,
      diffHours,
      diffDays,
      accuracy: diffDays <= 0.1 ? 'excellent' : 
                diffDays <= 0.5 ? 'good' : 
                diffDays <= 1.0 ? 'acceptable' : 'poor',
      year,
      solarTermId,
      solarTermName: this.SOLAR_TERM_NAMES[solarTermId]
    };
  }

  /**
   * 获取数据来源信息
   * @returns {Object} 数据来源说明
   */
  static getDataSourceInfo() {
    return {
      source: '中国科学院紫金山天文台 + 国家授时中心',
      coverage: '2022-2028年',
      accuracy: '商业级精度（分钟级）',
      update: '2025年9月',
      note: '专为商业产品优化，确保与竞品对比优势'
    };
  }
}

module.exports = AuthoritativeSolarTermsData;
