<!--history.wxml-->
<view class="container">
  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    
    <!-- å†å²è®°å½•åˆ—è¡¨ -->
    <view wx:if="{{historyList.length > 0}}">
      <!-- Bannerå¹¿å‘Š - å·²éšè—ï¼ˆå¾®ä¿¡å¹¿å‘Šç³»ç»Ÿè‡ªå·±é›†æˆï¼‰ -->

      <view class="card history-item" wx:for="{{historyList}}" wx:key="id" bindtap="viewResult" data-item="{{item}}">
        <!-- å¤´éƒ¨ä¿¡æ¯ -->
        <view class="history-header">
          <view class="history-name">
            {{item.display_name || item.user_info.name || item.birthInfo.name || 'åŒ¿åç”¨æˆ·'}}
            <text class="custom-note-badge" wx:if="{{item.has_custom_note}}">è‡ªå®šä¹‰</text>
          </view>
          <view class="history-date">{{item.formattedDate}}</view>
        </view>
        
        <!-- å…«å­—ä¿¡æ¯ -->
        <view class="history-bazi">
          <text class="bazi-text">{{item.bazi.year || item.year || 'ç”²å­'}}</text>
          <text class="bazi-text">{{item.bazi.month || item.month || 'ä¹™ä¸‘'}}</text>
          <text class="bazi-text">{{item.bazi.day || item.day || 'ä¸™å¯…'}}</text>
          <text class="bazi-text">{{item.bazi.hour || item.hour || 'ä¸å¯'}}</text>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="action-buttons">
          <view class="action-btn primary" catchtap="viewDetail" data-item="{{item}}">
            <text>æŸ¥çœ‹è¯¦æƒ…</text>
          </view>
          <view class="action-btn danger" catchtap="deleteItem" data-item="{{item}}">
            <text>åˆ é™¤</text>
          </view>
        </view>
      </view>
      
      <!-- æ¸…ç©ºæŒ‰é’®åŒºåŸŸ -->
      <view class="card clear-section">
        <button class="btn-danger" bindtap="clearAllHistory">æ¸…ç©ºå…¨éƒ¨å†å²è®°å½•</button>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="card empty-state">
      <view class="empty-icon">ğŸ“œ</view>
      <view class="empty-text">æš‚æ— å†å²è®°å½•</view>
      <view class="empty-desc">å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡å…«å­—æµ‹ç®—å§</view>
      <button class="btn-primary" bindtap="goToIndex">å¼€å§‹æµ‹ç®—</button>
    </view>

    <!-- å…è´£å£°æ˜ -->
    <view class="disclaimer">
      å†å²è®°å½•ä»…ä¿å­˜åœ¨æœ¬åœ°ï¼Œå¸è½½åº”ç”¨æˆ–æ¸…é™¤æ•°æ®å°†ä¼šä¸¢å¤±ã€‚<br/>
      å»ºè®®åŠæ—¶å¤‡ä»½é‡è¦çš„æµ‹ç®—ç»“æœã€‚
    </view>
  </view>
</view>
