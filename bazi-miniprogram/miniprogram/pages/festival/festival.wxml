<!--festival.wxml-->
<view class="container">
  <!-- ç®€åŒ–çš„é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="page-title-container">
      <view class="page-title">æœ€è¿‘èŠ‚æ—¥ ğŸŠ</view>
      <view class="page-subtitle">æœªæ¥13ä¸ªæœˆ Â· é»„å†å®œå¿Œ</view>
    </view>
    <view class="page-decoration">â˜¯ï¸</view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- æ›´æ–°æ—¶é—´ -->
    <view wx:if="{{lastUpdateTime}}" class="update-time">
      æœ€åæ›´æ–°ï¼š{{lastUpdateTime}}
    </view>
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½èŠ‚æ—¥æ•°æ®ä¸­...</text>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{error}}" class="error-container">
      <view class="error-icon">âš ï¸</view>
      <text class="error-text">{{error}}</text>
      <button class="retry-button" bindtap="onRetry">é‡è¯•</button>
    </view>

    <!-- èŠ‚æ—¥åˆ—è¡¨ -->
    <view wx:elif="{{festivals.length > 0}}" class="festival-list">
      <block wx:for="{{festivals}}" wx:key="id">
        <!-- èŠ‚æ—¥å¡ç‰‡ -->
        <view 
          class="festival-card {{item.popularityLevel}}"
          style="--primary-color: {{item.primaryColor}}; --accent-color: {{item.accentColor}};"
          data-festival="{{item}}"
          bindtap="onFestivalTap"
        >
          <!-- å¡ç‰‡é¡¶éƒ¨è£…é¥°æ¡ -->
          <view class="card-top-decoration" style="background: linear-gradient(90deg, {{item.primaryColor}}, {{item.accentColor}});"></view>
          
          <!-- å¤´éƒ¨åŒºåŸŸï¼šèŠ‚æ—¥åç§°å’Œç±»å‹ -->
          <view class="festival-header">
            <view class="header-main">
              <view class="festival-title-section">
                <text class="festival-emoji">{{item.iconEmoji}}</text>
                <text class="festival-name" style="color: {{item.primaryColor}};">{{item.name}}</text>
                <view class="festival-type-tag" style="background: {{item.accentColor}};">{{item.typeDisplay}}</view>
              </view>
            </view>
          </view>
          
          <!-- æ ¸å¿ƒä¿¡æ¯åŒºï¼šæ—¥æœŸ + å€’è®¡æ—¶çªå‡ºæ˜¾ç¤º -->
          <view class="core-info">
            <view class="date-section">
              <view class="date-main">
                <text class="solar-date">{{item.date}}</text>
                <text class="day-of-week">{{item.dayOfWeek}}</text>
              </view>
              <view class="lunar-date-display" wx:if="{{item.lunarDate}}">
                <text class="lunar-text">{{item.lunarDate}}</text>
              </view>
            </view>
            <view class="countdown-section">
              <view class="countdown-circle" style="border-color: {{item.primaryColor}};">
                <text class="countdown-number" style="color: {{item.primaryColor}};">{{item.daysUntil}}</text>
                <text class="countdown-unit">å¤©</text>
              </view>
              <text class="countdown-text">{{item.countdownText}}</text>
            </view>
          </view>
          
          <!-- æ–‡åŒ–ä¿¡æ¯åŒºï¼šæè¿° + ä¹ ä¿— -->
          <view class="cultural-info" wx:if="{{item.description}}">
            <view class="description-section">
              <text class="festival-description">{{item.description}}</text>
            </view>
            <view class="customs-section" wx:if="{{item.customs && item.customs.length > 0}}">
              <text class="customs-label">ä¸»è¦ä¹ ä¿—ï¼š</text>
              <view class="customs-tags">
                <text 
                  wx:for="{{item.customs}}" 
                  wx:for-item="custom"
                  wx:key="*this" 
                  class="custom-tag"
                  style="background: {{item.accentColor}};"
                >
                  {{custom}}
                </text>
              </view>
            </view>
          </view>
          
          <!-- ä¼ ç»Ÿä¿¡æ¯åŒºï¼šå¯æŠ˜å  -->
          <view class="traditional-info" wx:if="{{!item.isolarTerm}}">
            <view class="traditional-header">
              <text class="traditional-title">ä¼ ç»Ÿä¿¡æ¯</text>
              <text class="traditional-toggle">ğŸ‘ï¸</text>
            </view>
            <view class="traditional-content">
              <view class="info-grid">
                <view class="info-item" wx:if="{{item.ganZhi}}">
                  <text class="info-label">å€¼ç¥</text>
                  <text class="info-value">{{item.ganZhi}}</text>
                </view>
                <view class="info-item" wx:if="{{item.shierShen}}">
                  <text class="info-label">åäºŒç¥</text>
                  <text class="info-value">{{item.shierShen}}</text>
                </view>
                <view class="info-item full-width" wx:if="{{item.xingXiu}}">
                  <text class="info-label">æ˜Ÿå®¿</text>
                  <text class="info-value">{{item.xingXiu}}</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- å®œå¿Œæ´»åŠ¨åŒºï¼šä¼˜åŒ–å¸ƒå±€ -->
          <view class="activities-section" wx:if="{{item.activities && (item.activities.suitable.length > 0 || item.activities.unsuitable.length > 0)}}">
            <view class="activities-header">
              <text class="activities-title">å®œå¿Œæ´»åŠ¨</text>
            </view>
            <view class="activities-content">
              <view class="activity-group" wx:if="{{item.activities.suitable && item.activities.suitable.length > 0}}">
                <view class="activity-label suitable">
                  <text class="label-icon">âœ“</text>
                  <text class="label-text">å®œ</text>
                </view>
                <view class="activity-tags">
                  <text 
                    wx:for="{{item.activities.suitable}}" 
                    wx:for-item="activity"
                    wx:key="*this" 
                    class="activity-tag suitable-tag"
                  >
                    {{activity}}
                  </text>
                </view>
              </view>
              <view class="activity-group" wx:if="{{item.activities.unsuitable && item.activities.unsuitable.length > 0}}">
                <view class="activity-label unsuitable">
                  <text class="label-icon">âœ—</text>
                  <text class="label-text">å¿Œ</text>
                </view>
                <view class="activity-tags">
                  <text 
                    wx:for="{{item.activities.unsuitable}}" 
                    wx:for-item="activity"
                    wx:key="*this" 
                    class="activity-tag unsuitable-tag"
                  >
                    {{activity}}
                  </text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- é‡è¦ç¨‹åº¦æŒ‡ç¤ºå™¨ -->
          <view class="importance-indicator {{item.popularityLevel}}" wx:if="{{item.popularityLevel === 'popular'}}">
            <text class="importance-icon">â­</text>
          </view>
        </view>

        <!-- 5. èŠ‚æ—¥åˆ—è¡¨ä¸­çš„åŸç”Ÿå¹¿å‘Š - æ¯3ä¸ªèŠ‚æ—¥åæ’å…¥ä¸€ä¸ªå¹¿å‘Š -->
        <ad-native 
          wx:if="{{(index + 1) % 3 === 0 && index < festivals.length - 1}}"
          ad-type="native"
          page-name="festival"
          show-close-button="{{true}}"
          bind:adload="onNativeAdLoad"
          bind:adclick="onNativeAdClick"
          bind:adclose="onNativeAdClose"
          bind:aderror="onNativeAdError">
        </ad-native>
      </block>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-container">
      <view class="empty-icon">ğŸ“…</view>
      <text class="empty-text">æš‚æ— èŠ‚æ—¥æ•°æ®</text>
      <button class="retry-button" bindtap="onRetry">é‡æ–°åŠ è½½</button>
    </view>

    <!-- åº•éƒ¨è¯´æ˜ -->
    <view wx:if="{{festivals.length > 0}}" class="disclaimer">
      <text class="disclaimer-text">
        * ä¼ ç»Ÿå†æ³•ç»“åˆç°ä»£å¤©æ–‡ç®—æ³•ï¼Œæä¾›ç²¾å‡†çš„èŠ‚æ—¥ä¿¡æ¯ï¼Œå®œå¿Œå†…å®¹ä»…ä¾›å‚è€ƒ
      </text>
    </view>
  </view>
</view>
