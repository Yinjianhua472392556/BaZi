<!-- book-recommendation.wxml - ä¹¦ç±æ¨èç»„ä»¶æ¨¡æ¿ -->
<view class="book-recommendation {{layout}}">
  <!-- æ ‡é¢˜åŒºåŸŸ -->
  <view wx:if="{{showTitle}}" class="recommendation-header">
    <view class="recommendation-title">{{title}}</view>
    <view class="refresh-btn" bindtap="onRefresh" wx:if="{{!loading}}">
      <text class="refresh-icon">ğŸ”„</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½æ¨è...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-state">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="onRefresh">é‡è¯•</button>
  </view>

  <!-- æ— æ¨èçŠ¶æ€ -->
  <view wx:elif="{{recommendations.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">æš‚æ— ç›¸å…³ä¹¦ç±æ¨è</text>
  </view>

  <!-- æ¨èåˆ—è¡¨ -->
  <view wx:else class="recommendations-list {{layout}}-layout">
    <view 
      class="book-item {{layout}}-item"
      wx:for="{{recommendations}}"
      wx:key="id"
      bindtap="onBookTap"
      data-book="{{item}}"
    >
      <!-- ä¹¦ç±å°é¢ -->
      <view class="book-cover">
        <image 
          class="cover-image" 
          src="{{item.cover_url || '/images/book-placeholder.png'}}"
          mode="aspectFit"
          lazy-load="{{true}}"
        />
        <!-- ä»·æ ¼æ ‡ç­¾ -->
        <view class="price-tag" wx:if="{{item.price}}">
          Â¥{{item.price}}
        </view>
      </view>

      <!-- ä¹¦ç±ä¿¡æ¯ -->
      <view class="book-info">
        <view class="book-title">{{item.title}}</view>
        <view class="book-author" wx:if="{{item.author}}">{{item.author}}</view>
        <view class="book-description" wx:if="{{item.description}}">{{item.description}}</view>
        
        <!-- æ¨èç†ç”± -->
        <view class="recommendation-reason" wx:if="{{item.reason}}">
          <text class="reason-label">æ¨èç†ç”±ï¼š</text>
          <text class="reason-text">{{item.reason}}</text>
        </view>

        <!-- è¯„åˆ†å’Œé”€é‡ -->
        <view class="book-stats" wx:if="{{item.rating || item.sales}}">
          <view class="rating" wx:if="{{item.rating}}">
            <text class="rating-stars">â­</text>
            <text class="rating-score">{{item.rating}}</text>
          </view>
          <view class="sales" wx:if="{{item.sales}}">
            <text class="sales-text">é”€é‡ {{item.sales}}</text>
          </view>
        </view>

        <!-- æ ‡ç­¾ -->
        <view class="book-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text 
            class="tag-item"
            wx:for="{{item.tags}}"
            wx:key="*this"
            wx:for-item="tag"
          >{{tag}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="book-actions">
        <!-- ä¸»è¦è´­ä¹°æŒ‰é’® -->
        <button class="action-btn primary-btn" bindtap="onBookTap" data-book="{{item}}">
          ç«‹å³è´­ä¹°
        </button>
        
        <!-- æ¬¡è¦æ“ä½œæŒ‰é’® -->
        <view class="secondary-actions">
          <button 
            class="action-btn secondary-btn" 
            catchtap="onCollect" 
            data-book="{{item}}"
          >
            <text class="btn-icon">ğŸ’</text>
            æ”¶è—
          </button>
          <button 
            class="action-btn secondary-btn" 
            catchtap="onShare" 
            data-book="{{item}}"
          >
            <text class="btn-icon">ğŸ“¤</text>
            åˆ†äº«
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ›´å¤šæ¨èæŒ‰é’® -->
  <view class="more-recommendations" wx:if="{{recommendations.length > 0}}">
    <button class="more-btn" bindtap="onRefresh">
      <text class="more-icon">ğŸ”</text>
      æŸ¥çœ‹æ›´å¤šæ¨è
    </button>
  </view>
</view>
