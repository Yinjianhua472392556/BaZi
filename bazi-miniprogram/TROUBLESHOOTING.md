# å…«å­—è¿åŠ¿å°ç¨‹åº - æ•…éšœæŽ’é™¤æŒ‡å— ðŸ”§

> **2025-09-25 æ›´æ–°** - åŸºäºŽæœ€æ–°å®žé™…æ“ä½œç»éªŒæ•´ç†

## ðŸš€ å¿«é€Ÿè¯Šæ–­æ¸…å•

### 1. åŽç«¯æœåŠ¡é—®é¢˜è¯Šæ–­ (30ç§’)
```bash
# æ£€æŸ¥è™šæ‹ŸçŽ¯å¢ƒ
cd bazi-miniprogram && source venv/bin/activate && which python

# æ£€æŸ¥å…³é”®ä¾èµ–
pip list | grep -E "(fastapi|uvicorn|sxtwl|zhdate)"

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl -s http://10.60.20.222:8001/health

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i:8001
```

### 2. å‰ç«¯å°ç¨‹åºé—®é¢˜è¯Šæ–­ (30ç§’)
- [ ] å¾®ä¿¡å¼€å‘è€…å·¥å…·å·²å®‰è£…ä¸”æœ€æ–°ç‰ˆæœ¬
- [ ] é¡¹ç›®ç›®å½•æ­£ç¡®ï¼š`/Users/yinjianhua/Desktop/Demo/Bazi/bazi-miniprogram/miniprogram`
- [ ] åŸŸåæ ¡éªŒå·²å…³é—­ï¼šè¯¦æƒ… â†’ æœ¬åœ°è®¾ç½® â†’ ä¸æ ¡éªŒåŸŸå
- [ ] ç½‘ç»œè¯·æ±‚æ˜¾ç¤ºè¿žæŽ¥åˆ° `10.60.20.222:8001`

---

## ðŸ”¥ æœ€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: åŽç«¯æœåŠ¡å¯åŠ¨å¤±è´¥
**ç—‡çŠ¶**: `python main.py` æŠ¥é”™æˆ–æ— æ³•å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆA: æ£€æŸ¥è™šæ‹ŸçŽ¯å¢ƒ
cd bazi-miniprogram
source venv/bin/activate
python --version  # åº”æ˜¾ç¤º 3.13.7

# æ–¹æ¡ˆB: é‡æ–°å®‰è£…å…³é”®ä¾èµ–
pip install fastapi uvicorn sxtwl zhdate pillow

# æ–¹æ¡ˆC: æ£€æŸ¥ç«¯å£å†²çª
lsof -ti:8001 | xargs kill -9
python main.py
```

**æˆåŠŸæ ‡å¿—**:
```
âœ… ç®—æ³•æ¨¡å—å¯¼å…¥æˆåŠŸ
ðŸš€ å¯åŠ¨å…«å­—è¿åŠ¿å°ç¨‹åº FastAPI æœåŠ¡å™¨ (çœŸå®žç®—æ³•ç‰ˆ)
ðŸ“ æœ¬æœºIPåœ°å€: 10.60.20.222
ðŸŒ è®¿é—®åœ°å€: http://10.60.20.222:8001
```

### é—®é¢˜2: å°ç¨‹åºç½‘ç»œè¯·æ±‚å¤±è´¥
**ç—‡çŠ¶**: å°ç¨‹åºä¸­APIè°ƒç”¨å¤±è´¥ï¼ŒæŽ§åˆ¶å°æ˜¾ç¤ºç½‘ç»œé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. ç¡®è®¤åŽç«¯æœåŠ¡æ­£å¸¸
curl -s http://10.60.20.222:8001/health

# 2. å¾®ä¿¡å¼€å‘è€…å·¥å…·è®¾ç½®
# è¯¦æƒ… â†’ æœ¬åœ°è®¾ç½® â†’ âœ… ä¸æ ¡éªŒåˆæ³•åŸŸå
# è¯¦æƒ… â†’ æœ¬åœ°è®¾ç½® â†’ âœ… å¼€å¯è°ƒè¯•æ¨¡å¼

# 3. æ£€æŸ¥å°ç¨‹åºä¸­çš„è¯·æ±‚åœ°å€
# ç¡®ä¿ä½¿ç”¨ http://10.60.20.222:8001 è€Œä¸æ˜¯å…¶ä»–åœ°å€
```

### é—®é¢˜3: ç®—æ³•æ¨¡å—å¯¼å…¥å¤±è´¥
**ç—‡çŠ¶**: çœ‹åˆ° "âŒ ç®—æ³•æ¨¡å—å¯¼å…¥å¤±è´¥" æˆ– "é™çº§æ¨¡å¼"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥å…³é”®åº“å®‰è£…
pip list | grep sxtwl
pip list | grep zhdate

# é‡æ–°å®‰è£…ç®—æ³•åº“
pip uninstall sxtwl zhdate -y
pip install sxtwl==2.0.7 zhdate==0.1

# é‡å¯æœåŠ¡
python main.py
```

**æˆåŠŸæ ‡å¿—**: çœ‹åˆ° "âœ… ç®—æ³•æ¨¡å—å¯¼å…¥æˆåŠŸ" å’Œ "çœŸå®žç®—æ³•å·²å¯ç”¨"

### é—®é¢˜4: ç«¯å£è¢«å ç”¨
**ç—‡çŠ¶**: `Address already in use` æˆ–ç«¯å£å†²çªé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹å ç”¨è¿›ç¨‹
lsof -i:8001

# å¼ºåˆ¶æ€æ­»å ç”¨è¿›ç¨‹
lsof -ti:8001 | xargs kill -9

# æˆ–è€…ä¿®æ”¹ç«¯å£ (åœ¨ main.py æœ€åŽä¸€è¡Œ)
# uvicorn.run("main:app", host="0.0.0.0", port=8002, reload=True)
```

### é—®é¢˜5: IPåœ°å€å˜åŒ–å¯¼è‡´è¿žæŽ¥å¤±è´¥
**ç—‡çŠ¶**: å°ç¨‹åºæ— æ³•è¿žæŽ¥ï¼ŒAPIåœ°å€ä¸å¯¹

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æŸ¥çœ‹å½“å‰IP
python main.py | grep "æœ¬æœºIPåœ°å€"

# 2. æ›´æ–°å°ç¨‹åºä¸­çš„APIåœ°å€
# ç¼–è¾‘ miniprogram/utils/request.js æˆ–ç›¸å…³é…ç½®æ–‡ä»¶
# å°† baseURL æ›´æ–°ä¸ºæ–°çš„IPåœ°å€

# 3. ä½¿ç”¨å›ºå®šIP (å¯é€‰)
# åœ¨è·¯ç”±å™¨ä¸­ä¸ºå¼€å‘æœºå™¨è®¾ç½®é™æ€IP
```

---

## ðŸ›  è¿›é˜¶æ•…éšœæŽ’é™¤

### PythonçŽ¯å¢ƒé—®é¢˜

**é—®é¢˜**: pip å®‰è£…å¤±è´¥
```bash
# ä½¿ç”¨å›½å†…é•œåƒ
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ package_name

# å‡çº§pip
python -m pip install --upgrade pip

# æ¸…ç†ç¼“å­˜
pip cache purge
```

**é—®é¢˜**: è™šæ‹ŸçŽ¯å¢ƒé—®é¢˜
```bash
# é‡å»ºè™šæ‹ŸçŽ¯å¢ƒ
rm -rf venv
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### å¾®ä¿¡å¼€å‘è€…å·¥å…·é—®é¢˜

**é—®é¢˜**: å·¥å…·ç‰ˆæœ¬è¿‡æ—§
```bash
# æ›´æ–°å¾®ä¿¡å¼€å‘è€…å·¥å…·
# å·¥å…·èœå• â†’ æ£€æŸ¥æ›´æ–°

# æˆ–é‡æ–°ä¸‹è½½å®‰è£…
# https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
```

**é—®é¢˜**: é¡¹ç›®ç¼–è¯‘å¤±è´¥
```bash
# æ¸…é™¤ç¼“å­˜
# å·¥å…·æ  â†’ æ¸…ç¼“å­˜ â†’ æ¸…é™¤æ‰€æœ‰æ•°æ®

# é‡æ–°ç¼–è¯‘
# Cmd+Shift+R (macOS)
```

### æ€§èƒ½ç›¸å…³é—®é¢˜

**é—®é¢˜**: å¯åŠ¨é€Ÿåº¦æ…¢
```bash
# æ£€æŸ¥ç³»ç»Ÿèµ„æº
top -pid $(pgrep -f "python main.py")

# ä¼˜åŒ–è™šæ‹ŸçŽ¯å¢ƒä½ç½® (ç§»åŠ¨åˆ°SSD)
# æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
```

**é—®é¢˜**: APIå“åº”æ…¢
```bash
# æ£€æŸ¥ç®—æ³•åº“åŠ è½½æ—¶é—´
# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­çš„åˆå§‹åŒ–æ—¶é—´

# ç›‘æŽ§å†…å­˜ä½¿ç”¨
# åœ¨main.pyä¸­æ·»åŠ æ€§èƒ½ç›‘æŽ§
```

---

## ðŸ“± è®¾å¤‡ç›¸å…³é—®é¢˜

### macOSç‰¹å®šé—®é¢˜

**é—®é¢˜**: æƒé™é”™è¯¯
```bash
# ç»™äºˆå®Œæ•´ç£ç›˜è®¿é—®æƒé™
# ç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸Žéšç§ â†’ éšç§ â†’ å®Œæ•´ç£ç›˜è®¿é—®

# æ£€æŸ¥ç»ˆç«¯æƒé™
sudo chmod +x /usr/local/bin/python3
```

**é—®é¢˜**: Homebrewç›¸å…³
```bash
# æ›´æ–°Homebrew
brew update && brew upgrade

# é‡æ–°å®‰è£…Python
brew reinstall python@3.13
```

### ç½‘ç»œç›¸å…³é—®é¢˜

**é—®é¢˜**: é˜²ç«å¢™é˜»æ­¢
```bash
# ä¸´æ—¶å…³é—­é˜²ç«å¢™ (ä»…å¼€å‘çŽ¯å¢ƒ)
sudo pfctl -d

# æˆ–æ·»åŠ ç«¯å£è§„åˆ™
# ç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸Žéšç§ â†’ é˜²ç«å¢™ â†’ é˜²ç«å¢™é€‰é¡¹
# æ·»åŠ  Python åº”ç”¨å…è®¸åˆ—è¡¨
```

**é—®é¢˜**: DNSè§£æžé—®é¢˜
```bash
# åˆ·æ–°DNSç¼“å­˜
sudo dscacheutil -flushcache
sudo killall -HUP mDNSResponder
```

---

## ðŸ” è°ƒè¯•æŠ€å·§

### åŽç«¯è°ƒè¯•
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
python main.py --log-level debug

# ç›‘æŽ§ç½‘ç»œè¯·æ±‚
# åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://10.60.20.222:8001/docs
# ä½¿ç”¨ Swagger UI æµ‹è¯•æŽ¥å£

# æŸ¥çœ‹å®žæ—¶æ—¥å¿—
tail -f logs/app.log  # å¦‚æžœæœ‰æ—¥å¿—æ–‡ä»¶
```

### å‰ç«¯è°ƒè¯•
```bash
# å¾®ä¿¡å¼€å‘è€…å·¥å…·è°ƒè¯•æŠ€å·§:
# 1. æ‰“å¼€è°ƒè¯•å™¨: F12 æˆ– Cmd+Opt+I
# 2. æŸ¥çœ‹Networkæ ‡ç­¾é¡µç›‘æŽ§è¯·æ±‚
# 3. æŸ¥çœ‹ConsoleæŸ¥çœ‹JSé”™è¯¯
# 4. ä½¿ç”¨StorageæŸ¥çœ‹æœ¬åœ°å­˜å‚¨

# çœŸæœºè°ƒè¯•
# å¼€å‘è€…å·¥å…· â†’ é¢„è§ˆ â†’ ç”ŸæˆäºŒç»´ç 
# ç”¨å¾®ä¿¡æ‰«ç åœ¨çœŸæœºä¸Šæµ‹è¯•
```

### æ€§èƒ½åˆ†æž
```bash
# åŽç«¯æ€§èƒ½åˆ†æž
pip install pytest-benchmark
python -m pytest tests/ --benchmark-only

# å†…å­˜ä½¿ç”¨åˆ†æž
pip install memory-profiler
python -m memory_profiler main.py
```

---

## ðŸ†˜ ç´§æ€¥æ•‘æ´æ–¹æ¡ˆ

### å®Œå…¨é‡ç½®é¡¹ç›® (æœ€åŽæ‰‹æ®µ)
```bash
# 1. å¤‡ä»½æ•°æ®
cp -r bazi-miniprogram bazi-miniprogram-backup

# 2. é‡ç½®è™šæ‹ŸçŽ¯å¢ƒ
cd bazi-miniprogram
rm -rf venv __pycache__
python -m venv venv
source venv/bin/activate

# 3. é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é‡å¯æœåŠ¡
python main.py
```

### é™çº§è¿è¡Œæ–¹æ¡ˆ
å¦‚æžœç®—æ³•åº“æ— æ³•å®‰è£…ï¼Œé¡¹ç›®æ”¯æŒé™çº§æ¨¡å¼ï¼š
```bash
# é¡¹ç›®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼
# åŠŸèƒ½ä¾ç„¶å¯ç”¨ï¼Œä½†ä½¿ç”¨æ¨¡æ‹Ÿçš„å…«å­—è®¡ç®—ç»“æžœ
# å¯ç”¨äºŽæ¼”ç¤ºå’ŒåŸºç¡€åŠŸèƒ½éªŒè¯
```

### è”ç³»æ”¯æŒ
å¦‚æžœé—®é¢˜ä»æ— æ³•è§£å†³ï¼š
1. æŸ¥çœ‹ `QUICK_START.md` åŸºç¡€æŒ‡å—
2. æŸ¥çœ‹ `PROJECT_FINAL_STATUS.md` é¡¹ç›®çŠ¶æ€
3. æ£€æŸ¥ GitHub Issues
4. æŸ¥çœ‹é¡¹ç›®æ—¥å¿—æ–‡ä»¶

---

## ðŸ“Š çŠ¶æ€æ£€æŸ¥å·¥å…·

### è‡ªåŠ¨è¯Šæ–­è„šæœ¬
```bash
# åˆ›å»ºè¯Šæ–­è„šæœ¬
cat > diagnose.sh << 'EOF'
#!/bin/bash
echo "ðŸ” å…«å­—å°ç¨‹åºè¯Šæ–­å¼€å§‹..."

echo "1. æ£€æŸ¥PythonçŽ¯å¢ƒ..."
cd bazi-miniprogram && source venv/bin/activate
python --version

echo "2. æ£€æŸ¥å…³é”®ä¾èµ–..."
pip list | grep -E "(fastapi|uvicorn|sxtwl|zhdate)"

echo "3. æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
curl -s http://10.60.20.222:8001/health || echo "âŒ æœåŠ¡æœªè¿è¡Œ"

echo "4. æ£€æŸ¥ç«¯å£..."
lsof -i:8001 || echo "âœ… ç«¯å£ç©ºé—²"

echo "ðŸ“Š è¯Šæ–­å®Œæˆ"
EOF

chmod +x diagnose.sh
./diagnose.sh
```

---

**æœ€åŽæ›´æ–°**: 2025-09-25  
**æµ‹è¯•çŽ¯å¢ƒ**: macOS, Python 3.13.7, å¾®ä¿¡å¼€å‘è€…å·¥å…·æœ€æ–°ç‰ˆ  
**é¡¹ç›®çŠ¶æ€**: âœ… å®Œå…¨æ­£å¸¸è¿è¡Œ
