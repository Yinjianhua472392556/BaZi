# 八字小程序项目开发清单

## 项目概览
- **项目名称**: 八字运势小程序
- **开发周期**: 4周
- **团队规模**: 1人
- **技术栈**: 微信小程序 + Python FastAPI + AI API

## 第一阶段：环境准备与基础搭建（第1周）

### 开发环境准备
- [ ] 安装微信开发者工具
- [ ] 注册微信小程序账号
- [ ] 申请小程序AppID
- [ ] 安装Python 3.8+
- [ ] 安装VS Code或其他IDE
- [ ] 注册云服务器账号（腾讯云/阿里云）

### 项目初始化
- [ ] 创建项目目录结构
```bash
mkdir bazi-miniprogram
cd bazi-miniprogram
mkdir backend miniprogram docs
```
- [ ] 初始化Git仓库
- [ ] 创建Python虚拟环境
- [ ] 安装后端依赖包
- [ ] 创建基础项目文件

### 核心算法开发
- [ ] 实现天干地支基础数据结构
- [ ] 开发年柱计算算法
- [ ] 开发月柱计算算法  
- [ ] 开发日柱计算算法
- [ ] 开发时柱计算算法
- [ ] 实现五行分析功能
- [ ] 编写单元测试验证算法正确性

### 必需文件清单
```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py
│   ├── services/
│   │   ├── __init__.py
│   │   └── bazi_calculator.py
│   └── config.py
├── requirements.txt
└── tests/
    └── test_bazi_calculator.py
```

## 第二阶段：后端API开发（第2周前半）

### 开源依赖安装配置
- [ ] 安装核心框架依赖
```bash
pip install fastapi==0.104.1 uvicorn[standard]==0.24.0
pip install python-multipart==0.0.6 requests==2.31.0
pip install pydantic==2.5.0 python-dateutil==2.8.2
```
- [ ] 安装高精度八字计算库
```bash
pip install sxtwl==1.1.3 zhdate==0.1 chinese-calendar==1.8.0
pip install pytz==2023.3 lunardate==0.2.0
```
- [ ] 安装数据库和缓存支持
```bash
pip install sqlalchemy==2.0.23 alembic==1.13.1
pip install redis==5.0.1 aiofiles==23.2.1
```
- [ ] 安装开发和测试工具
```bash
pip install pytest==7.4.3 pytest-asyncio==0.21.1 httpx==0.25.2
pip install black==23.11.0 flake8==6.1.0 mypy==1.7.1
```

### API接口开发
- [ ] 搭建FastAPI基础框架
- [ ] 实现增强八字计算API (`/api/calculate-bazi`)
  - [ ] 集成sxtwl高精度农历转换
  - [ ] 实现十神关系分析
  - [ ] 添加纳音五行计算
  - [ ] 支持时区处理
- [ ] 实现缘分指数API (`/api/calculate-yuanfen`)
  - [ ] 五行互补性算法
  - [ ] 天干地支合冲分析
  - [ ] 性格匹配度计算
- [ ] 实现今日运势API (`/api/today-fortune`)
- [ ] 添加CORS跨域支持
- [ ] 添加错误处理机制

### AI服务集成与多平台支持
- [ ] 实现AI服务接口抽象层
  - [ ] 阿里云通义千问集成
  - [ ] OpenAI GPT备选方案
  - [ ] 本地Ollama LLM支持
- [ ] 注册AI服务提供商账号
- [ ] 获取API密钥并配置环境变量
- [ ] 实现Prompt模板管理系统
- [ ] 设计合规的八字分析Prompt
- [ ] 实现AI调用缓存机制（Redis）
- [ ] 添加AI内容过滤和审核
- [ ] 测试所有AI接口调用

### 数据库设计
- [ ] 设计数据库表结构
- [ ] 创建SQLite数据库文件
- [ ] 实现数据模型类
- [ ] 添加数据库操作函数

### API测试
- [ ] 使用Postman或其他工具测试API
- [ ] 验证数据格式正确性
- [ ] 测试错误处理机制
- [ ] 记录API使用文档

## 第三阶段：小程序前端开发（第2周后半）

### 小程序基础设置
- [ ] 创建小程序项目
- [ ] 配置app.json基础设置
- [ ] 设计整体UI风格
- [ ] 引入Vant Weapp组件库

### 页面开发
- [ ] **首页 (index)**
  - [ ] 功能入口设计
  - [ ] 今日最旺星座展示
  - [ ] 导航功能实现
  
- [ ] **八字测算页 (bazi)**
  - [ ] 出生信息输入表单
  - [ ] 日期时间选择器
  - [ ] 八字计算调用
  - [ ] 结果展示界面
  - [ ] 加载状态处理

- [ ] **缘分测试页 (yuanfen)**
  - [ ] 双人信息输入
  - [ ] 缘分指数展示
  - [ ] 匹配度分析显示

- [ ] **历史记录页 (history)**
  - [ ] 本地存储管理
  - [ ] 历史记录列表
  - [ ] 记录详情查看

### API集成
- [ ] 配置API接口地址
- [ ] 实现网络请求封装
- [ ] 添加请求错误处理
- [ ] 实现数据缓存机制

## 第四阶段：广告集成与优化（第3周）

### 广告功能集成
- [ ] 申请微信广告组件权限
- [ ] 配置广告位ID
- [ ] 实现横幅广告展示
- [ ] 实现插屏广告逻辑
- [ ] 添加广告加载失败处理

### 分享功能
- [ ] 实现结果分享卡片生成
- [ ] 配置分享参数
- [ ] 测试分享功能
- [ ] 优化分享内容

### 性能优化
- [ ] 代码压缩优化
- [ ] 图片资源优化
- [ ] 网络请求优化
- [ ] 小程序包大小优化

### 用户体验优化
- [ ] 加载动画添加
- [ ] 错误提示优化
- [ ] 交互反馈完善
- [ ] 页面跳转动画

## 第五阶段：合规准备与提审（第4周前半）

### 合规材料准备
- [ ] 完善免责声明
  - [ ] 首页显著位置添加免责声明
  - [ ] 每个功能页面添加娱乐提醒
  - [ ] 结果页面添加特别说明
  - [ ] AI分析添加生成内容说明
- [ ] 准备隐私政策文档
  - [ ] 明确数据收集范围
  - [ ] 说明信息使用方式
  - [ ] 详述存储和保护措施
  - [ ] 提供用户权利说明
- [ ] 制作用户协议
  - [ ] 服务说明和内容介绍
  - [ ] 用户义务和禁止行为
  - [ ] 服务限制和免责范围
  - [ ] 知识产权和争议解决
- [ ] 完成内容自查报告
  - [ ] 敏感词汇排查和替换
  - [ ] AI内容审核机制建立
  - [ ] 用户引导内容规范
  - [ ] 合规检查清单确认

### 技术合规实现
- [ ] 实现敏感词过滤系统
```python
# 集成敏感词过滤库
pip install python-profanity-check
# 或使用自定义过滤规则
```
- [ ] 添加AI内容后置审核
- [ ] 实现用户举报处理机制
- [ ] 配置内容缓存和审核日志

### 审核材料整理
- [ ] 截取所有页面免责声明截图
- [ ] 整理技术实现说明文档
- [ ] 准备传统文化支撑材料
- [ ] 制作功能演示视频

## 第六阶段：部署上线（第4周后半）

### 后端部署
- [ ] 购买云服务器（推荐腾讯云轻量应用服务器）
- [ ] 配置服务器环境
```bash
# 安装Docker和相关工具
sudo apt update
sudo apt install docker.io docker-compose
sudo systemctl start docker
sudo systemctl enable docker
```
- [ ] 部署后端API
```bash
# 使用Docker部署
docker build -t bazi-api .
docker run -d -p 8000:8000 --name bazi-api bazi-api
```
- [ ] 配置域名和SSL证书
- [ ] 配置Nginx反向代理
- [ ] 测试线上API接口

### 小程序提审准备
- [ ] 完善小程序基本信息
  - [ ] 设置小程序名称和介绍
  - [ ] 上传小程序头像和截图
  - [ ] 选择正确的服务类别
  - [ ] 添加客服联系方式
- [ ] 代码质量检查
  - [ ] 清理调试代码和注释
  - [ ] 优化代码结构和性能
  - [ ] 检查所有功能正常运行
  - [ ] 验证合规内容显示

### 小程序审核提交
- [ ] 上传小程序代码
- [ ] 填写版本信息和更新说明
- [ ] 提交审核申请
- [ ] 准备审核问询回复材料

### 监控和日志
- [ ] 配置应用日志系统
```python
# 集成日志监控
pip install python-json-logger structlog
```
- [ ] 设置错误监控（Sentry集成）
- [ ] 配置性能监控和告警
- [ ] 建立数据备份机制

## 关键里程碑检查点

### 第1周末检查
- [ ] 八字计算算法验证通过
- [ ] 基础API接口可正常调用
- [ ] 开发环境完全搭建

### 第2周末检查  
- [ ] 所有API接口开发完成
- [ ] 小程序基础页面完成
- [ ] AI集成功能正常

### 第3周末检查
- [ ] 广告功能集成完成
- [ ] 分享功能测试通过
- [ ] 性能优化完成

### 第4周末检查
- [ ] 后端成功部署上线
- [ ] 小程序提审成功
- [ ] 监控系统正常运行

## 应急预案和解决方案

### 高风险项应急方案

#### 1. 小程序审核被拒应急方案

**常见拒绝原因及对策**:

**拒绝原因A: 涉及封建迷信**
- [ ] **即时响应** (24小时内)
  - [ ] 立即修改所有预测性表述
  - [ ] 强化"仅供娱乐参考"提示
  - [ ] 调整应用定位为"传统文化学习工具"
- [ ] **内容调整** (48小时内)
  - [ ] 增加天干地支知识科普内容
  - [ ] 添加传统文化历史介绍
  - [ ] 弱化算命属性，强化教育属性
- [ ] **备选版本准备**
  - [ ] 简化版：仅保留八字排盘功能
  - [ ] 教育版：重点突出文化学习价值

**拒绝原因B: 内容表述不当**
- [ ] **文本审查** (即时)
  - [ ] 使用敏感词检测工具全面扫描
  - [ ] 替换所有绝对性表述词汇
  - [ ] 增加概率性和建议性语言
- [ ] **AI内容重训练**
  - [ ] 更新Prompt模板，强化合规要求
  - [ ] 重新训练内容过滤规则
  - [ ] 人工审核所有AI生成内容样本

#### 2. AI服务中断应急方案

**主要AI服务商故障**:
- [ ] **自动切换机制** (5分钟内)
  - [ ] 通义千问 → OpenAI GPT切换
  - [ ] GPT故障 → 本地Ollama模型切换
  - [ ] 全部AI故障 → 预设文案库启用
- [ ] **本地备份方案**
  - [ ] 部署本地Ollama LLM服务器
  - [ ] 准备1000+条预设分析文案
  - [ ] 实现智能模板匹配算法

**成本控制失效**:
- [ ] **API调用限制**
  - [ ] 实现每日调用上限（1000次）
  - [ ] 用户级别调用频率限制（10次/小时）
  - [ ] 缓存机制最大化命中率
- [ ] **降级策略**
  - [ ] AI分析改为可选功能
  - [ ] 广告观看解锁AI分析
  - [ ] 简化版AI分析（降低token消耗）

#### 3. 服务器性能问题应急方案

**高并发访问**:
- [ ] **水平扩容** (30分钟内)
  - [ ] 启动负载均衡器配
